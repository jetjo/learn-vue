<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>History Api</title>
        <script>
            function printHistory ( e ) {
                console.log( window.history.state );
            }
        </script>
        <script>
            function pushState1 () {
                const state = { page_id: 1, user_id: 5 };
                const url = './home.html';
                history.pushState( state, '', url );
            }
        </script>
        <script>
            function pushState2 () {
                // console.log( 'location: ', location );
                const url = new URL( location );
                url.searchParams.set( 'foo', 'bar' );
                history.pushState( {}, "", url );
                // console.log( 'location: ', location );
            }
        </script>
        <script>
            function pushState3 () {
                const url = new URL( location );
                url.hash = 'top';
                history.pushState( { label: '改变hash' }, "", url );
            }
        </script>
        <script>
            function reloadWindow () {
                location.reload();
            }
        </script>
        <script>
            // NOTE: 触发了这个事件,并不一定history.length会改变,比如
            // 点击页面上的锚点时,会触发此事件,但是如果点击前,url的hash已经是
            // 当前的锚点了,那么history.length就不变;
            // 并且如果点击前的页面的history.state不是null,那么点击后history.state不变,
            // 此时event.state虽然是null.也就是说event.state不一定是事件发生后页面的history.state
            window.addEventListener( "popstate", ( e ) => {
                console.log( 'popstate: ', e );
            } )
        </script>
        <script>
            // NOTE: 通过pushState改变hash不会触发
            window.addEventListener( "hashchange", ( e ) => {
                console.log( 'hashchange: ', e );
                console.log( 'location: ', location );
                console.log( 'location.hash: ', location.hash );
            } )
        </script>
    </head>

    <body>
        <p><button onclick="printHistory()">打印history.state</button></p>
        <p><button onclick="pushState1()">pushState1改变地址</button></p>
        <p><button onclick="pushState2()">pushState2改变queryString</button></p>
        <p><button onclick="pushState3()">pushState3改变hash</button></p>
        <p><button onclick="reloadWindow()">reload</button></p>
        <p>history.pushState的作用: 改变地址栏地址,当然也会追加一条记录,但是页面没有重载,还是调用前的页面!!!</p>
        <p>并且即使调用时传递的地址参数与当前地址只有hash不同,也不会触发hashchange事件;并且页面也不会导航到hash指定的锚点!!!</p>
        <!-- NOTE: history.pushState的作用: 改变地址栏地址,当然也会追加一条记录,但是页面没有重载,还是调用前的页面!!! -->
        <p><a href="./index.html">Index</a></p>
        <p><a href="./home.html">Home</a></p>
        <p><a href="#top">页面顶部</a></p>
        <p><a href="#footer">页面底部</a></p>
        <p><a href="//www.google.com">Google</a></p>
    </body>

</html>
